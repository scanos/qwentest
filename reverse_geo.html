<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Table with Map</title>
    <script src="exif.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB2RYFaiLK0eKC3AZlcI45YmcJ7wfEBuiw&libraries=places"></script>
    <style>
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; border: 1px solid #ccc; }
        img { max-width: 100px; max-height: 100px; }
        #map { height: 500px; width: 100%; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Image Metadata and Map</h1>
    <table>
        <tr>
            <th>Image Name</th>
            <th>Thumbnail</th>
            <th>Geolocation Metadata</th>
            <th>Reverse Geocoded Address</th>
        </tr>
        <tbody id="imageTable"></tbody>
    </table>
    <div id="map"></div>

    <script>
        const images = ['h1.jpg', 'h2.jpg', 'h3.jpg', 'h4.jpg'];
        const mapCenter = { lat: 33.8938, lng: 35.5018 }; // Beirut, Lebanon
        let map;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: mapCenter,
                zoom: 15,
                mapTypeId: 'roadmap'
            });
        }

        function reverseGeocode(lat, lng, callback) {
            const geocoder = new google.maps.Geocoder();
            const latlng = new google.maps.LatLng(lat, lng);
            geocoder.geocode({ location: latlng }, (results, status) => {
                if (status === 'OK' && results[0]) {
                    callback(results[0].formatted_address);
                } else {
                    callback('Address not found');
                }
            });
        }

        function processImage(imgName) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${imgName}</td>
                <td><img src="${imgName}" alt="${imgName}"></td>
                <td>Loading...</td>
                <td>Loading...</td>
            `;
            document.getElementById('imageTable').appendChild(row);

            const img = new Image();
            img.src = imgName;
            img.onload = () => {
                EXIF.getData(img, function() {
                    const lat = EXIF.getTag(this, 'GPSLatitude');
                    const lng = EXIF.getTag(this, 'GPSLongitude');
                    if (lat && lng) {
                        const latDec = lat[0] + lat[1] / 60 + lat[2] / 3600;
                        const lngDec = lng[0] + lng[1] / 60 + lng[2] / 3600;
                        row.cells[2].innerText = `Lat: ${latDec.toFixed(6)}, Lng: ${lngDec.toFixed(6)}`;
                        reverseGeocode(latDec, lngDec, address => {
                            row.cells[3].innerText = address;
                        });
                        new google.maps.Marker({
                            position: { lat: latDec, lng: lngDec },
                            map: map,
                            title: imgName
                        });
                    } else {
                        row.cells[2].innerText = 'No geolocation data';
                        row.cells[3].innerText = 'Cannot reverse geocode';
                    }
                });
            };
        }

        window.onload = () => {
            initMap();
            images.forEach(img => processImage(img));
        };
    </script>
</body>
</html>
