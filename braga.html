<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Version 8 - Top 10 Places to Visit in Braga</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        #map {
            height: 100vh;
            width: 100%;
        }
        .flashing-marker {
            animation: flash 1s infinite;
        }
        @keyframes flash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }
    </style>
</head>
<body>
    <h1 style="text-align: center;">Top 10 Places to Visit in Braga</h1>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Initialize the map
        const map = L.map('map').setView([41.5503, -8.4201], 14); // Braga Cathedral coordinates

        // Add OpenStreetMap tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Define the top 10 places to visit in Braga
        const places = [
            { name: "Braga Cathedral", coords: [41.5503, -8.4201] },
            { name: "Bom Jesus do Monte", coords: [41.5627, -8.3694] },
            { name: "Sanctuary of Our Lady of Sameiro", coords: [41.5686, -8.3778] },
            { name: "The Garden of Santa Bárbara", coords: [41.5507, -8.4196] },
            { name: "Arch of the New Gate", coords: [41.5487, -8.4204] },
            { name: "Palace of the Dukes of Braganza", coords: [41.5503, -8.4221] },
            { name: "Museum of Image", coords: [41.5505, -8.4213] },
            { name: "Santa Cruz Church", coords: [41.5510, -8.4217] },
            { name: "Rúa do Souto", coords: [41.5506, -8.4212] },
            { name: "Espaço Vita", coords: [41.5509, -8.4218] }
        ];

        // Function to calculate distance between two coordinates (Haversine formula)
        function getDistance(coord1, coord2) {
            const R = 6371e3; // Earth radius in meters
            const φ1 = (coord1[0] * Math.PI) / 180;
            const φ2 = (coord2[0] * Math.PI) / 180;
            const Δφ = ((coord2[0] - coord1[0]) * Math.PI) / 180;
            const Δλ = ((coord2[1] - coord1[1]) * Math.PI) / 180;

            const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) +
                      Math.cos(φ1) * Math.cos(φ2) *
                      Math.sin(Δλ / 2) * Math.sin(Δλ / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c; // Distance in meters
        }

        // Sort places by distance from Braga Cathedral
        const sortedPlaces = [...places].sort((a, b) => 
            getDistance(places[0].coords, a.coords) - getDistance(places[0].coords, b.coords)
        );

        // Add markers for each place
        const markers = [];
        sortedPlaces.forEach((place, index) => {
            const marker = L.marker(place.coords).addTo(map);
            marker.bindPopup(`${index + 1}. ${place.name}`);
            markers.push(marker);
        });

        // Track the current location index
        let currentIndex = 0;

        // Highlight the next location with a flashing marker
        function highlightNextLocation() {
            if (currentIndex >= sortedPlaces.length - 1) {
                alert("You've visited all the locations!");
                return;
            }

            // Remove flashing class from previous marker
            if (currentIndex > 0) {
                markers[currentIndex].setIcon(L.icon({ iconUrl: 'https://unpkg.com/leaflet/dist/images/marker-icon.png' }));
            }

            // Move to the next location
            currentIndex++;

            // Flash the next marker
            const nextMarker = markers[currentIndex];
            nextMarker.setIcon(L.icon({
                iconUrl: 'https://unpkg.com/leaflet/dist/images/marker-icon.png',
                className: 'flashing-marker'
            }));
            map.setView(sortedPlaces[currentIndex].coords, 14);
            nextMarker.openPopup();
        }

        // Attach click event to the first marker
        markers[0].on('click', highlightNextLocation);
    </script>
</body>
</html>