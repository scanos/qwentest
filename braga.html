<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Version 8 - Top 10 Places to Visit in Braga</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }
    #map {
      width: 100%;
      height: 100vh;
    }
    h1 {
      text-align: center;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <h1>Top 10 Places to Visit in Braga, Portugal</h1>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Initialize the map
    const map = L.map('map').setView([41.5499, -8.4201], 13); // Centered on Braga

    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // Define the top 10 places to visit in Braga
    const places = [
      { name: "Braga Cathedral", coords: [41.5499, -8.4201] },
      { name: "Bom Jesus do Monte", coords: [41.5624, -8.3773] },
      { name: "Sanctuary of Sameiro", coords: [41.5547, -8.3984] },
      { name: "Theatro Circo", coords: [41.5499, -8.4207] },
      { name: "Santa Barbara Garden", coords: [41.5511, -8.4247] },
      { name: "Archbishop's Palace", coords: [41.5499, -8.4211] },
      { name: "Museu dos Biscainhos", coords: [41.5492, -8.4219] },
      { name: "Palace of Raio", coords: [41.5492, -8.4219] },
      { name: "Church of São Victor", coords: [41.5475, -8.4206] },
      { name: "Cidade Romana de Bracara Augusta", coords: [41.5499, -8.4201] }
    ];

    // Create markers for all places
    const markers = places.map(place => {
      const marker = L.marker(place.coords).addTo(map);
      marker.bindPopup(`<b>${place.name}</b>`).closePopup();
      return marker;
    });

    // Function to calculate distance between two coordinates
    function calculateDistance(coord1, coord2) {
      const [lat1, lng1] = coord1;
      const [lat2, lng2] = coord2;
      return Math.sqrt(Math.pow(lat1 - lat2, 2) + Math.pow(lng1 - lng2, 2));
    }

    // Initialize variables
    let currentPlaceIndex = 0; // Start with Braga Cathedral
    let polyline = null; // To store the line drawn between locations

    // Highlight the first marker (Braga Cathedral)
    function highlightMarker(index) {
      markers.forEach(marker => marker.setIcon(L.icon({ iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png', iconSize: [25, 41], iconAnchor: [12, 41] })));
      markers[index].setIcon(L.icon({ iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png', iconSize: [50, 82], iconAnchor: [25, 82] }));
    }

    // Function to move to the next location
    function moveToNextLocation() {
      if (currentPlaceIndex >= places.length - 1) {
        alert("You have visited all the locations!");
        return;
      }

      // Find the nearest location
      const currentCoords = places[currentPlaceIndex].coords;
      const nearestIndex = places
        .map((place, index) => ({ index, distance: calculateDistance(currentCoords, place.coords) }))
        .filter(item => item.index > currentPlaceIndex)
        .reduce((nearest, current) => (current.distance < nearest.distance ? current : nearest)).index;

      // Draw a line from the current location to the next location
      if (polyline) map.removeLayer(polyline);
      polyline = L.polyline([places[currentPlaceIndex].coords, places[nearestIndex].coords], { color: 'blue' }).addTo(map);

      // Update the current place index
      currentPlaceIndex = nearestIndex;

      // Highlight the new marker
      highlightMarker(currentPlaceIndex);

      // Center the map on the new location
      map.setView(places[currentPlaceIndex].coords, 15);
    }

    // Set up click event listeners for markers
    markers.forEach((marker, index) => {
      marker.on('click', () => {
        if (index === currentPlaceIndex) {
          moveToNextLocation();
        }
      });
    });

    // Highlight the initial marker (Braga Cathedral)
    highlightMarker(currentPlaceIndex);

    // Center the map on Braga Cathedral initially
    map.setView(places[currentPlaceIndex].coords, 15);
  </script>
</body>
</html>