<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Geo-Location Viewer</title>
    <script src="exif.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key="></script>
    <style>
        table { width: 100%; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 8px; text-align: left; }
    </style>
</head>
<body>
    <h2>Image Geolocation Data</h2>
    <table>
        <thead>
            <tr>
                <th>Image Name</th>
                <th>Geo-Location</th>
            </tr>
        </thead>
        <tbody id="imageTableBody"></tbody>
    </table>
    
    <h2>Google Map</h2>
    <div id="map" style="width:100%; height:500px;"></div>
    
    <script>
        let map;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 33.8938, lng: 35.5018 },
                zoom: 12
            });
        }
        
        function getImages() {
            fetch('.')
                .then(response => response.text())
                .then(text => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(text, 'text/html');
                    const files = Array.from(doc.querySelectorAll('a'))
                        .map(a => a.href)
                        .filter(href => href.endsWith('.jpg'));
                    
                    files.forEach(file => processImage(file));
                });
        }

        function processImage(imgSrc) {
            const img = new Image();
            img.src = imgSrc;
            img.onload = function () {
                EXIF.getData(img, function () {
                    const lat = EXIF.getTag(this, "GPSLatitude");
                    const lon = EXIF.getTag(this, "GPSLongitude");
                    const latRef = EXIF.getTag(this, "GPSLatitudeRef");
                    const lonRef = EXIF.getTag(this, "GPSLongitudeRef");
                    
                    let geoText = "No GPS Data";
                    let valid = false;
                    
                    if (lat && lon && latRef && lonRef) {
                        const latitude = (lat[0] + lat[1] / 60 + lat[2] / 3600) * (latRef === 'S' ? -1 : 1);
                        const longitude = (lon[0] + lon[1] / 60 + lon[2] / 3600) * (lonRef === 'W' ? -1 : 1);
                        geoText = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
                        valid = true;
                    }
                    
                    const tableRow = `<tr><td>${imgSrc}</td><td>${geoText}</td></tr>`;
                    document.getElementById("imageTableBody").innerHTML += tableRow;
                    
                    if (valid) {
                        new google.maps.Marker({
                            position: { lat: parseFloat(latitude), lng: parseFloat(longitude) },
                            map: map,
                            title: imgSrc
                        });
                    }
                });
            };
        }

        window.onload = function () {
            initMap();
            getImages();
        };
    </script>
</body>
</html>
