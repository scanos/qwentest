<script>
  // Function to convert DMS (Degrees, Minutes, Seconds) to Decimal Degrees
  function dmsToDecimal(dms, ref) {
    const [degrees, minutes, seconds] = dms;
    let decimal = degrees + minutes / 60 + seconds / 3600;
    if (ref === 'S' || ref === 'W') {
      decimal = -decimal;
    }
    return decimal;
  }

  // Fetch the directory listing
  fetch('directory_listing.json')
    .then(response => response.json())
    .then(images => {
      images.forEach(imageName => {
        const img = new Image();
        img.src = `https://scanos.github.io/qwentest/${imageName}`;
        img.onload = function() {
          EXIF.getData(img, function() {
            const lat = EXIF.getTag(this, 'GPSLatitude');
            const latRef = EXIF.getTag(this, 'GPSLatitudeRef');
            const lon = EXIF.getTag(this, 'GPSLongitude');
            const lonRef = EXIF.getTag(this, 'GPSLongitudeRef');

            let latitude = lat && latRef ? dmsToDecimal(lat, latRef) : 'N/A';
            let longitude = lon && lonRef ? dmsToDecimal(lon, lonRef) : 'N/A';

            // Add a new row to the table
            const table = document.getElementById('imageTable').getElementsByTagName('tbody')[0];
            const newRow = table.insertRow();
            const nameCell = newRow.insertCell(0);
            const latCell = newRow.insertCell(1);
            const lonCell = newRow.insertCell(2);

            nameCell.textContent = imageName;
            latCell.textContent = latitude;
            lonCell.textContent = longitude;
          });
        };
      });
    })
    .catch(error => console.error('Error fetching directory listing:', error));
</script>
