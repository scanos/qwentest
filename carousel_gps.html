<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Geo-location Display</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=&libraries=places"></script>
    <script src="Exif.js"></script>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 8px;
            text-align: left;
        }
        .map {
            width: 100%;
            height: 500px;
        }
        .thumbnail {
            width: 100px;
            height: 100px;
        }
    </style>
</head>
<body>

    <h1>Image Metadata with Geo-location</h1>

    <table>
        <thead>
            <tr>
                <th>Image Name</th>
                <th>Thumbnail</th>
                <th>Geolocation</th>
            </tr>
        </thead>
        <tbody id="image-table">
            <!-- Table rows will be dynamically inserted here -->
        </tbody>
    </table>

    <div id="map" class="map"></div>

    <script>
        const imageFiles = ['h1.jpg', 'h2.jpg', 'h3.jpg', 'h4.jpg'];
        const geolocationData = [];

        // Initialize the Google Map centered on Beirut
        function initMap() {
            const center = { lat: 33.8888, lng: 35.4944 }; // Central Beirut, Lebanon
            const map = new google.maps.Map(document.getElementById('map'), {
                zoom: 16,
                center: center
            });

            // Iterate through images and extract geolocation
            imageFiles.forEach((image, index) => {
                const reader = new FileReader();
                const imgPath = image;

                reader.onload = function(event) {
                    const arrayBuffer = event.target.result;
                    const exif = new Exif();
                    exif.load(arrayBuffer, function() {
                        const gpsData = exif.getGPSData();
                        if (gpsData) {
                            const latitude = gpsData.latitude;
                            const longitude = gpsData.longitude;
                            geolocationData.push({ image: image, lat: latitude, lng: longitude });

                            // Create a marker on the map
                            const marker = new google.maps.Marker({
                                position: { lat: latitude, lng: longitude },
                                map: map,
                                title: image
                            });
                        }

                        // Add table row for the image
                        const table = document.getElementById('image-table');
                        const row = document.createElement('tr');
                        
                        const imageNameCell = document.createElement('td');
                        imageNameCell.textContent = image;
                        
                        const thumbnailCell = document.createElement('td');
                        const imgThumbnail = document.createElement('img');
                        imgThumbnail.src = imgPath;
                        imgThumbnail.classList.add('thumbnail');
                        thumbnailCell.appendChild(imgThumbnail);

                        const geoCell = document.createElement('td');
                        if (gpsData) {
                            geoCell.textContent = `Lat: ${gpsData.latitude}, Lng: ${gpsData.longitude}`;
                        } else {
                            geoCell.textContent = 'No geolocation data available';
                        }

                        row.appendChild(imageNameCell);
                        row.appendChild(thumbnailCell);
                        row.appendChild(geoCell);
                        table.appendChild(row);
                    });
                };

                // Read the image file
                fetch(imgPath)
                    .then(response => response.arrayBuffer())
                    .then(arrayBuffer => reader.readAsArrayBuffer(arrayBuffer))
                    .catch(err => console.log('Error loading image:', err));
            });
        }

        window.onload = initMap;
    </script>
</body>
</html>
