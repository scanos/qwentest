<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image Geolocation</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=&callback=initMap" async defer></script>
    <script src="exif.js"></script>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        table, th, td {
            border: 1px solid black;
        }
        th, td {
            padding: 10px;
            text-align: center;
        }
        img {
            width: 100px;
            height: auto;
        }
        #map {
            height: 500px;
            width: 100%;
        }
    </style>
</head>
<body>

<h1>Image Geolocation</h1>

<table id="imageTable">
    <thead>
        <tr>
            <th>Image Name</th>
            <th>Thumbnail</th>
            <th>Geolocation</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>h1.jpg</td>
            <td><img src="h1.jpg" alt="h1" id="thumb1"></td>
            <td id="geo1">Loading...</td>
        </tr>
        <tr>
            <td>h2.jpg</td>
            <td><img src="h2.jpg" alt="h2" id="thumb2"></td>
            <td id="geo2">Loading...</td>
        </tr>
        <tr>
            <td>h3.jpg</td>
            <td><img src="h3.jpg" alt="h3" id="thumb3"></td>
            <td id="geo3">Loading...</td>
        </tr>
        <tr>
            <td>h4.jpg</td>
            <td><img src="h4.jpg" alt="h4" id="thumb4"></td>
            <td id="geo4">Loading...</td>
        </tr>
    </tbody>
</table>

<div id="map"></div>

<script>
    var map;
    var markers = [];

    function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: 33.8886, lng: 35.4950 },  // Central Beirut, Lebanon
            zoom: 15
        });

        // Images and their file paths
        var images = ['h1.jpg', 'h2.jpg', 'h3.jpg', 'h4.jpg'];
        var geolocationData = [];

        images.forEach((image, index) => {
            // Fetch EXIF data and extract geolocation info
            fetch(image)
                .then(response => response.blob())
                .then(blob => {
                    EXIF.getData(blob, function() {
                        var lat = EXIF.getTag(this, "GPSLatitude");
                        var lon = EXIF.getTag(this, "GPSLongitude");

                        if (lat && lon) {
                            var latitude = EXIF.getTag(this, "GPSLatitude");
                            var longitude = EXIF.getTag(this, "GPSLongitude");
                            var geo = { lat: latitude, lon: longitude };

                            geolocationData.push(geo);

                            var latLng = { lat: latitude, lng: longitude };
                            var marker = new google.maps.Marker({
                                position: latLng,
                                map: map,
                                title: image
                            });

                            markers.push(marker);

                            // Update the table with geolocation data
                            document.getElementById('geo' + (index + 1)).innerText = `Lat: ${latitude}, Lon: ${longitude}`;
                        } else {
                            document.getElementById('geo' + (index + 1)).innerText = "No geolocation data";
                        }
                    });
                });
        });
    }

    window.onload = initMap;
</script>

</body>
</html>
