<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nearest City Finder</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body {
      margin: 0;
      padding: 0;
    }
    #map {
      width: 100%;
      height: 100vh;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Function to fetch the nearest city using reverse geocoding
    async function getNearestCity(lat, lon) {
      const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=10&addressdetails=1`;
      const response = await fetch(url);
      const data = await response.json();
      return data.address.city || data.address.town || data.address.village || "Unknown Location";
    }

    // Function to initialize the map and add a marker for the nearest city
    async function initMap() {
      // Check if geolocation is supported by the browser
      if (!navigator.geolocation) {
        alert("Geolocation is not supported by your browser.");
        return;
      }

      // Get the user's current position
      navigator.geolocation.getCurrentPosition(async (position) => {
        const { latitude, longitude } = position.coords;

        // Fetch the nearest city
        const city = await getNearestCity(latitude, longitude);

        // Use Nominatim to get the coordinates of the city center
        const cityUrl = `https://nominatim.openstreetmap.org/search?city=${encodeURIComponent(city)}&format=json&limit=1`;
        const cityResponse = await fetch(cityUrl);
        const cityData = await cityResponse.json();

        if (cityData.length === 0) {
          alert("Could not find the city center coordinates.");
          return;
        }

        const cityLat = parseFloat(cityData[0].lat);
        const cityLon = parseFloat(cityData[0].lon);

        // Initialize the map
        const map = L.map('map').setView([cityLat, cityLon], 13);

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19,
          attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        // Add a marker for the city center
        const marker = L.marker([cityLat, cityLon]).addTo(map);
        marker.bindPopup(`<b>${city}</b>`).openPopup();

        console.log(`Nearest city: ${city}`);
      }, (error) => {
        alert(`Error getting location: ${error.message}`);
      });
    }

    // Initialize the map when the page loads
    window.onload = initMap;
  </script>
</body>
</html>