<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Walking Route Plan</title>
<style>
  #map {
    height: 500px;
    width: 100%;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }
  th, td {
    border: 1px solid black;
    padding: 8px;
    text-align: center;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
<div id="map"></div>
<table>
  <thead>
    <tr>
      <th>From</th>
      <th>To</th>
      <th>Distance (m)</th>
      <th>Time (min)</th>
    </tr>
  </thead>
  <tbody id="routeTableBody">
  </tbody>
  <tfoot>
    <tr>
      <td colspan="2"><strong>Total</strong></td>
      <td id="totalDistance"></td>
      <td id="totalTime"></td>
    </tr>
  </tfoot>
</table>

<script>
  const latLngArray = [
    [33.89462777777778, 35.51548611111111],
    [33.88783333333333, 35.515369444444445],
    [33.89488333333333, 35.51550833333334],
    [33.89487222222222, 35.515525]
  ];

  const map = L.map('map').setView(latLngArray[0], 15);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(map);

  let totalDistance = 0;
  let totalTime = 0;

  function reverseGeocode(lat, lon) {
    return fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`)
      .then(response => response.json())
      .then(data => data.display_name.split(', ')[0]);
  }

  async function calculateRoute() {
    for (let i = 0; i < latLngArray.length - 1; i++) {
      const fromLatLng = latLngArray[i];
      const toLatLng = latLngArray[i + 1];

      // Draw lines on the map
      L.polyline([fromLatLng, toLatLng], { color: 'blue' }).addTo(map);

      // Reverse geocoding
      const fromName = await reverseGeocode(fromLatLng[0], fromLatLng[1]);
      const toName = await reverseGeocode(toLatLng[0], toLatLng[1]);

      // Calculate distance and time
      const distance = Math.sqrt(
        Math.pow(toLatLng[0] - fromLatLng[0], 2) +
        Math.pow(toLatLng[1] - fromLatLng[1], 2)
      ) * 111000; // Approximate distance in meters
      const time = Math.ceil(distance / 80); // Walking speed ~80m/min

      totalDistance += distance;
      totalTime += time;

      // Add row to table
      const row = `
        <tr>
          <td>${fromName}</td>
          <td>${toName}</td>
          <td>${Math.round(distance)}</td>
          <td>${time}</td>
        </tr>
      `;
      document.getElementById('routeTableBody').insertAdjacentHTML('beforeend', row);
    }

    // Update total distance and time
    document.getElementById('totalDistance').textContent = `${Math.round(totalDistance)} m`;
    document.getElementById('totalTime').textContent = `${Math.ceil(totalTime / 60)} min`;
  }

  calculateRoute();

  // Mark locations on the map
  latLngArray.forEach((latLng, index) => {
    L.marker(latLng).addTo(map)
      .bindPopup(`Location ${index + 1}`)
      .openPopup();
  });

  // Fit bounds to include all markers
  const bounds = L.latLngBounds(latLngArray);
  map.fitBounds(bounds);
</script>
</body>
</html>