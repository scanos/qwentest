<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Walking Route Plan</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<style>
  #map { height: 500px; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; }
  th, td { border: 1px solid black; padding: 8px; text-align: center; }
</style>
</head>
<body>
<div id="map"></div>
<table>
  <thead>
    <tr>
      <th>From</th>
      <th>To</th>
      <th>Distance (m)</th>
      <th>Time (min)</th>
    </tr>
  </thead>
  <tbody id="routeTableBody"></tbody>
  <tfoot>
    <tr>
      <td colspan="2"><strong>Total</strong></td>
      <td id="totalDistance"></td>
      <td id="totalTime"></td>
    </tr>
  </tfoot>
</table>

<script>
const locations = [
  [33.89462777777778, 35.51548611111111],
  [33.88783333333333, 35.515369444444445],
  [33.89488333333333, 35.51550833333334],
  [33.89487222222222, 35.515525]
];

let map = L.map('map').setView(locations[0], 15);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19,
  attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

// Function to reverse geocode
function reverseGeocode(latlng) {
  return fetch(`https://nominatim.openstreetmap.org/reverse?lat=${latlng[0]}&lon=${latlng[1]}&format=json`)
    .then(response => response.json())
    .then(data => data.display_name.split(",")[0]);
}

// Add markers and get addresses
Promise.all(locations.map(reverseGeocode))
  .then(addresses => {
    locations.forEach((loc, i) => {
      L.marker(loc).addTo(map).bindPopup(addresses[i]).openPopup();
    });

    // Calculate walking directions
    const routeTableBody = document.getElementById('routeTableBody');
    let totalDistance = 0;
    let totalTime = 0;

    for (let i = 0; i < locations.length - 1; i++) {
      const from = locations[i];
      const to = locations[i + 1];

      fetch(`https://router.project-osrm.org/route/v1/foot/${from[1]},${from[0]};${to[1]},${to[0]}?overview=false`)
        .then(response => response.json())
        .then(data => {
          const leg = data.routes[0].legs[0];
          const distance = Math.round(leg.distance);
          const duration = Math.round(leg.duration / 60); // Convert seconds to minutes

          totalDistance += distance;
          totalTime += duration;

          const row = `<tr>
            <td>${addresses[i]}</td>
            <td>${addresses[i + 1]}</td>
            <td>${distance}</td>
            <td>${duration}</td>
          </tr>`;
          routeTableBody.innerHTML += row;

          if (i === locations.length - 2) {
            document.getElementById('totalDistance').textContent = totalDistance + ' m';
            document.getElementById('totalTime').textContent = totalTime + ' min';
          }

          // Draw route on the map
          const routeCoordinates = data.routes[0].geometry.coordinates.map(coord => [coord[1], coord[0]]);
          L.polyline(routeCoordinates, { color: 'blue' }).addTo(map);
        });
    }
  });
</script>
</body>
</html>